# 贝塞尔曲线与B样条曲线原理说明

## 一、贝塞尔曲线（Bezier Curve）
用于计算参数方程的公式（二项式系数）：

    C(n, i) = n! / (i! * (n - i)!)

    B(t) = Σ [ C(n, i) * (1-t)^(n-i) * t^i * P_i ]      i ∈ [0,n]   n = 控制点个数 - 1
### 示例
对于5个控制点，n = 4，

    则 B(t) = C(4,0) * (1-t)^4 * t^0 * P0 + 
                C(4,1) * (1-t)^3 * t^1 * P1 + 
                C(4,2) * (1-t)^2 * t^2 * P2 + 
                C(4,3) * (1-t)^1 * t^3 * P3 + 
                C(4,4) * (1-t)^0 * t*4 *P4

而 t 是平滑后点的个数，t ∈ [0,1]，例如 t = 15，那么就需要在[0,1]中均匀的取15个点，也就是将[0,1]均分成14份，<br/>因此t的取值为 0, 1\/14, 2\/14, ..., 13\/14, 1;

那么对于已知坐标的五个点P0, P1, P2, P3, P4,
将15个t值代入上边解出的参数方程，即可获取15个平滑后的点的坐标。

## 二、B样条曲线（B-Spline Curve）

B样条曲线的推导依赖于**基函数**。  
现实中常用 **三次B样条曲线（Cubic B-Spline）**。

### 示例

例如设定4个控制点：
| 控制点 | 坐标  |
|:------:|:------:|
| P₀ | (1, 1) |
| P₁ | (4, 8) |
| P₂ | (8, 5) |
| P₃ | (10, 2) |

曲线次数 (p): p = 3 (三次)
对于4个控制点（n=3）和三次曲线（p=3），需要 n + p + 2 = 3 + 3 + 2 = 8 个节点，
即U = {u₀, u₁, u₂, u₃, u₄, u₅, u₆, u₇} = {0, 0, 0, 0, 1, 2, 2, 2}

之后确定要计算的曲线点，比如说五个点的话，就是u = 0, 0.5, 1, 1.5, 2

### 基函数值
#### 基函数的递推计算公式为：

< img src="https://github.com/Gerrylgr/trajectory_optimization/blob/master/B-spline/image/image.png" width="500px">

**E.g.** 以u = 0.5为例，递推计算出三次基函数公式的过程：<br/>
<br/>

< img src="https://github.com/Gerrylgr/trajectory_optimization/blob/master/B-spline/image/image-1.png" width="500px">

< img src="https://github.com/Gerrylgr/trajectory_optimization/blob/master/B-spline/image/image-2.png" width="500px">

< img src="https://github.com/Gerrylgr/trajectory_optimization/blob/master/B-spline/image/image-3.png" width="500px">
< img src="https://github.com/Gerrylgr/trajectory_optimization/blob/master/B-spline/image/image-4.png" width="500px">

< img src="https://github.com/Gerrylgr/trajectory_optimization/blob/master/B-spline/image/image-5.png" width="500px">
< img src="https://github.com/Gerrylgr/trajectory_optimization/blob/master/B-spline/image/image-6.png" width="500px">

则（按照上边的递推计算过程）最终计算出的基函数的值为：
| u | N₀,₃(u) | N₁,₃(u) | N₂,₃(u) | N₃,₃(u) |
|:--:|:--:|:--:|:--:|:--:|
| 0.0 | 1.0000 | 0.0000 | 0.0000 | 0.0000 |
| 0.5 | 0.0625 | 0.5625 | 0.3750 | 0.0000 |
| 1.0 | 0.0000 | 0.1667 | 0.6667 | 0.1667 |
| 1.5 | 0.0000 | 0.0208 | 0.4792 | 0.5000 |
| 2.0 | 0.0000 | 0.0000 | 0.0000 | 1.0000 |

### 计算曲线点坐标
#### **C(u) = Σ Nᵢ,₃(u) * Pᵢ：**

    计算 C(0):
        C(0) = 1*P₀ + 0*P₁ + 0*P₂ + 0*P₃ = 1*(1, 1) + 0 + 0 + 0 = (1, 1) (验证：等于P₀)
    计算 C(0.5):
        C(0.5) = 0.0625*P₀ + 0.5625*P₁ + 0.3750*P₂ + 0*P₃ = 0.0625*(1, 1) + 0.5625*(4, 8) + 0.3750*(8, 5)
            x = 0.06251 + 0.56254 + 0.3750*8 = 0.0625 + 2.25 + 3.0 = 5.3125
            y = 0.06251 + 0.56258 + 0.3750*5 = 0.0625 + 4.5 + 1.875 = 6.4375
            C(0.5) ≈ (5.31, 6.44)
    计算 C(1.0):
        C(1.0) = 0*P₀ + 0.1667*P₁ + 0.6667*P₂ + 0.1667*P₃ = 0.1667*(4, 8) + 0.6667*(8, 5) + 0.1667*(10, 2)
            x = 0.16674 + 0.66678 + 0.1667*10 ≈ 0.67 + 5.33 + 1.67 = 7.67
            y = 0.16678 + 0.66675 + 0.1667*2 ≈ 1.33 + 3.33 + 0.33 = 5.00
            C(1.0) ≈ (7.67, 5.00)
    计算 C(1.5):
        C(1.5) = 0*P₀ + 0.0208*P₁ + 0.4792*P₂ + 0.5000*P₃ = 0.0208*(4, 8) + 0.4792*(8, 5) + 0.5000*(10, 2)
            x = 0.02084 + 0.47928 + 0.5000*10 ≈ 0.08 + 3.83 + 5.0 = 8.91
            y = 0.02088 + 0.47925 + 0.5000*2 ≈ 0.17 + 2.40 + 1.0 = 3.57
            C(1.5) ≈ (8.91, 3.57)
    计算 C(2):
        C(2) = 0 * P₀ + 0 * P₁ + 0 * P₂ + 1 * P₃ = 0 + 0 + 0 + 1*(10, 2) = (10, 2) (验证：等于P₃)

则通过计算得到了平滑曲线上的5个点：
| u | C(u) |
|:--:|:--:|
| 0.0 | (1.00, 1.00) |
| 0.5 | (5.31, 6.44) |
| 1.0 | (7.67, 5.00) |
| 1.5 | (8.91, 3.57) |
| 2.0 | (10.0, 2.00) |

